<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Mybatis框架学习, Hexo">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Mybatis框架学习 | Hexo</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Mybatis框架学习</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-04-11
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Mybatis框架搭建全过程学习"><a href="#Mybatis框架搭建全过程学习" class="headerlink" title="Mybatis框架搭建全过程学习    "></a>Mybatis框架搭建全过程学习    </h1><hr>
<h1 id="Mybatis框架简介"><a href="#Mybatis框架简介" class="headerlink" title="Mybatis框架简介:"></a>Mybatis框架简介:</h1><ol>
<li><strong>什么是框架:</strong><br>框架（Framework）是整个或部分系统的可重用设计，表现为一组抽象构件及构件实例间交互的方法;另一种<br>定义认为，框架是可被应用开发者定制的应用骨架。前者是从应用方面而后者是从目的方面给出的定义。<br>简而言之，框架其实就是某种应用的半成品，就是一组组件，供你选用完成你自己的系统。简单说就是使用别<br>人搭好的舞台，你来做表演。而且，框架一般是成熟的，不断升级的软件。   </li>
<li><strong>框架要解决的问题:</strong><br>框架要解决的最重要的一个问题是技术整合的问题，在 J2EE 的 框架中，有着各种各样的技术，不同的<br>软件企业需要从 J2EE 中选择不同的技术，这就使得软件企业最终的应用依赖于这些技术，技术自身的复杂性和技<br>术的风险性将会直接对应用造成冲击。而应用是软件企业的核心，是竞争力的关键所在，因此应该将应用自身的设<br>计和具体的实现技术解耦。这样，软件企业的研发将集中在应用的设计上，而不是具体的技术实现，技术实现是应<br>用的底层支撑，它不应该直接对应用产生影响。   </li>
<li><strong>软件开发的分层重要性</strong><br>框架的重要性在于它实现了部分功能，并且能够很好的将低层应用平台和高层业务逻辑进行了缓和。为了实现<br>软件工程中的“高内聚、低耦合”。把问题划分开来各个解决，易于控制，易于延展，易于分配资源。我们常见的<br>MVC 软件设计思想就是很好的分层思想。</li>
<li>Mybatis框架：<br>mybatis 是一个优秀的基于 java 的持久层框架，它内部封装了 jdbc，使开发者只需要关注 sql 语句本身，<br>而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。<br>mybatis 通过 xml 或注解的方式将要执行的各种 statement 配置起来，并通过 java 对象和 statement 中<br>sql 的动态参数进行映射生成最终执行的 sql 语句，最后由 mybatis 框架执行 sql 并将结果映射为 java 对象并<br>返回。<br>采用 ORM 思想解决了实体和数据库映射的问题，对 jdbc 进行了封装，屏蔽了 jdbc api 底层访问细节，使我<br>们不用与 jdbc api 打交道，就可以完成对数据库的持久化操作。<br>为了我们能够更好掌握框架运行的内部过程，并且有更好的体验，下面我们将从自定义 Mybatis 框架开始来<br>学习框架。此时我们将会体验框架从无到有的过程体验，也能够很好的综合前面阶段所学的基础</li>
</ol>
<h2 id="Stept-1-JDBC编程的分析"><a href="#Stept-1-JDBC编程的分析" class="headerlink" title="#Stept 1: JDBC编程的分析"></a>#Stept 1: JDBC编程的分析</h2><hr>
<h4 id="1-jdbc程序的回顾"><a href="#1-jdbc程序的回顾" class="headerlink" title="1.jdbc程序的回顾"></a>1.jdbc程序的回顾</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">Connection connection &#x3D; null;</span><br><span class="line">PreparedStatement preparedStatement &#x3D; null;</span><br><span class="line">ResultSet resultSet &#x3D; null;</span><br><span class="line">try &#123;</span><br><span class="line">&#x2F;&#x2F;加载数据库驱动</span><br><span class="line">Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">&#x2F;&#x2F;通过驱动管理类获取数据库链接</span><br><span class="line">connection &#x3D; DriverManager.getConnection(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?characterEncoding&#x3D;utf-8&quot;,&quot;root&quot;, &quot;root&quot;);</span><br><span class="line">&#x2F;&#x2F;定义 sql 语句 ?表示占位符</span><br><span class="line">String sql &#x3D; &quot;select * from user where username &#x3D; ?&quot;;</span><br><span class="line">&#x2F;&#x2F;获取预处理 statement</span><br><span class="line">preparedStatement &#x3D; connection.prepareStatement(sql);</span><br><span class="line">&#x2F;&#x2F;设置参数，第一个参数为 sql 语句中参数的序号（从 1 开始），第二个参数为设置的参数值</span><br><span class="line">preparedStatement.setString(1, &quot;王五&quot;);</span><br><span class="line">&#x2F;&#x2F;向数据库发出 sql 执行查询，查询出结果集</span><br><span class="line">resultSet &#x3D; preparedStatement.executeQuery();</span><br><span class="line">&#x2F;&#x2F;遍历查询结果集</span><br><span class="line">while(resultSet.next())&#123;</span><br><span class="line"> System.out.println(resultSet.getString(&quot;id&quot;)+&quot;&quot;+resultSet.getString(&quot;username&quot;));</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;finally&#123;</span><br><span class="line">&#x2F;&#x2F;释放资源</span><br><span class="line">if(resultSet!&#x3D;null)&#123;</span><br><span class="line">try &#123;</span><br><span class="line">resultSet.close();</span><br><span class="line">&#125; catch (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; &#125;</span><br><span class="line">if(preparedStatement!&#x3D;null)&#123;</span><br><span class="line">try &#123;</span><br><span class="line">preparedStatement.close();</span><br><span class="line">&#125; catch (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; &#125;</span><br><span class="line">if(connection!&#x3D;null)&#123;</span><br><span class="line">try &#123;</span><br><span class="line">connection.close();</span><br><span class="line">&#125; catch (SQLException e) &#123;</span><br><span class="line">&#x2F;&#x2F; TODO Auto-generated catch block</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作</span><br></pre></td></tr></table></figure>
<h4 id="2-jdbc问题分析"><a href="#2-jdbc问题分析" class="headerlink" title="2.jdbc问题分析"></a>2.jdbc问题分析</h4><p>1、数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。<br>2、Sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java<br>代码。<br>3、使用 preparedStatement 向占有位符号传参数存在硬编码，因为 sql 语句的 where 条件不一定，可能<br>多也可能少，修改 sql 还要修改代码，系统不易维护。<br>4、对结果集解析存在硬编码（查询列名），sql 变化导致解析代码变化，系统不易维护，如果能将数据库记<br>录封装成 pojo 对象解析比较方便。     </p>
<h2 id="step-2-Mybatis框架快速入门"><a href="#step-2-Mybatis框架快速入门" class="headerlink" title="#step 2: Mybatis框架快速入门"></a>#step 2: Mybatis框架快速入门</h2><p>通过前面的学习，我们已经能够使用所学的基础知识构建自定义的 Mybatis 框架了。这个过程是基本功的考<br>验，我们已经强大了不少，但现实是残酷的，我们所定义的 Mybatis 框架和真正的 Mybatis 框架相比，还是显得<br>渺小。行业内所流行的 Mybatis 框架现在我们将开启学习。</p>
<hr>
<h4 id="1-搭建Mybatis开发环境"><a href="#1-搭建Mybatis开发环境" class="headerlink" title="1.搭建Mybatis开发环境"></a>1.搭建Mybatis开发环境</h4><ul>
<li>1.创建maven工程    </li>
<li>2.添加 Mybatis3.4.5 的坐标：<br>在pom.xml文件中添加Mybatis3.4.5 的坐标，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis_day01&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.4.5&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.10&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.12&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li>3.编写User类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.domain;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private Integer userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private String userAddress;</span><br><span class="line">    private String userSex;</span><br><span class="line">    private Date userBirthday;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;userId&#x3D;&quot; + userId +</span><br><span class="line">                &quot;, userName&#x3D;&#39;&quot; + userName + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, userAddress&#x3D;&#39;&quot; + userAddress + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, userSex&#x3D;&#39;&quot; + userSex + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, userBirthday&#x3D;&quot; + userBirthday +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getUserId() &#123;</span><br><span class="line">        return userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserId(Integer userId) &#123;</span><br><span class="line">        this.userId &#x3D; userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName &#x3D; userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserAddress() &#123;</span><br><span class="line">        return userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserAddress(String userAddress) &#123;</span><br><span class="line">        this.userAddress &#x3D; userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserSex() &#123;</span><br><span class="line">        return userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserSex(String userSex) &#123;</span><br><span class="line">        this.userSex &#x3D; userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getUserBirthday() &#123;</span><br><span class="line">        return userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserBirthday(Date userBirthday) &#123;</span><br><span class="line">        this.userBirthday &#x3D; userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>4.编写持久层接口IUserDao<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.dao;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface IUserDao &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>5.编写配置文件<br>在resources文件目录下创建一个三层的文件夹和dao包的层次跟名字一样在文件目录下面创建一个IUserDao.xml的配置文件<br><img src="/images/mybatis1.png" alt="img"><br>配置文件的内容为:   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.itfeifei.dao.IUserDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置查询所以操作--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">            select * from user;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>
在resources目录下面编写SqlMapConfig.xml配置文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;   </span><br><span class="line">    &lt;!-- 配置 mybatis 的环境 --&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;!-- 配置 mysql 的环境 --&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;!-- 配置事务的类型 --&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&gt;&lt;&#x2F;transactionManager&gt;</span><br><span class="line">            &lt;!-- 配置连接数据库的信息：用的是数据源(连接池) --&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">            &lt;!--需要编写jdbcConfig.properties文件在resources文件目录下--&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;jdbc.driver&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;!-- 告知 mybatis 映射配置的位置 --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;package resource&#x3D;&quot;com&#x2F;itfefei&#x2F;dao&#x2F;IUserDao.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure></li>
<li>6.编写测试类   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.test;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.dao.IUserDao;</span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line">public class MybatisTest &#123;</span><br><span class="line">    public static void main(String[] args)throws Exception &#123;</span><br><span class="line">    &#x2F;&#x2F;1.读取配置文件</span><br><span class="line">    InputStream in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">    &#x2F;&#x2F;2.创建 SqlSessionFactory 的构建者对象</span><br><span class="line">    SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">    &#x2F;&#x2F;3.使用构建者创建工厂对象 SqlSessionFactory</span><br><span class="line">    SqlSessionFactory factory &#x3D; builder.build(in);</span><br><span class="line">    &#x2F;&#x2F;4.使用 SqlSessionFactory 生产 SqlSession 对象</span><br><span class="line">    SqlSession session &#x3D; factory.openSession();</span><br><span class="line">    &#x2F;&#x2F;5.使用 SqlSession 创建 dao 接口的代理对象</span><br><span class="line">    IUserDao userDao &#x3D; session.getMapper(IUserDao.class);</span><br><span class="line">    &#x2F;&#x2F;6.使用代理对象执行查询所有方法</span><br><span class="line">    List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">    for(User user : users) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;7.释放资源</span><br><span class="line">    session.close();</span><br><span class="line">    in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>7.小结<br>通过快速入门示例，我们发现使用 mybatis 是非常容易的一件事情，因为只需要编写 Dao 接口并且按照<br>mybatis 要求编写两个配置文件，就可以实现功能。远比我们之前的 jdbc 方便多了。（我们使用注解之后，将变得<br>更为简单，只需要编写一个 mybatis 配置文件就够了。）<br>但是，这里面包含了许多细节，比如为什么会有工厂对象（SqlSessionFactory）,为什么有了工厂之后还<br>要有构建者对象（SqlSessionFactoryBuilder），为什么 IUserDao.xml 在创建时有位置和文件名的要求等等。<br>这些问题我们在自定义 mybatis 框架的章节，通过层层剥离的方式，给大家讲解。<br>请注意：我们讲解自定义 Mybatis 框架，不是让大家回去自己去写个 mybatis，而是让我们能更好了了解<br>mybatis 内部是怎么执行的，在以后的开发中能更好的使用 mybatis 框架，同时对它的设计理念（设计模式）有<br>一个认识。<br><img src="/images/mybatis2.png" alt="img"><br><img src="/images/mybatis3.png" alt="img">        </li>
<li>8.基于注解的mybatis使用<br>在持久层接口添加注解<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public interface IUserDao &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">    * 查询所有用户</span><br><span class="line">    * @return</span><br><span class="line">    *&#x2F;</span><br><span class="line">    @Select(&quot;select * from user&quot;)</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
修改SqlMapConfig.xml<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt; </span><br><span class="line">    &lt;mapper class&#x3D;&quot;com.itfeifei.dao.IUserDao&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>注意事项：**<br>在使用基于注解mybatis配置时，请移除xml的映射配置(IUserDao.xml)     </li>
</ul>
</li>
</ul>
<h2 id="Step-3-自定义Mybatis"><a href="#Step-3-自定义Mybatis" class="headerlink" title="#Step 3: 自定义Mybatis"></a>#Step 3: 自定义Mybatis</h2><hr>
<h4 id="1-涉及知识点介绍"><a href="#1-涉及知识点介绍" class="headerlink" title="1.涉及知识点介绍:"></a>1.涉及知识点介绍:</h4><p>本章我们将使用前面所学的基础知识来构建一个属于自己的持久层框架，将会涉及到的一些知识点：工厂模式<br>（Factory 工厂模式）、构造者模式（Builder 模式）、代理模式，反射，自定义注解，注解的反射，xml 解析，<br>数据库元数据，元数据的反射等。     </p>
<h4 id="2-流程分析"><a href="#2-流程分析" class="headerlink" title="2.流程分析"></a>2.流程分析</h4><p><img src="/images/mybatis4.png" alt="img">  </p>
<h4 id="3-动态代理分析"><a href="#3-动态代理分析" class="headerlink" title="3.动态代理分析"></a>3.动态代理分析</h4><p>动态代理是许多框架底层实现的基础，比如Spirng的AOP等，其实弄清楚了动态代理的实现原理，它就没那么神奇了，下面就来通过案例和分析JDK底层源码来揭秘她的神秘面纱，让她一丝不挂地呈现在我们面前，邪恶了。。    </p>
<ul>
<li>1.动态代理定义<br>存在一个代理对象，并且这个代理对象持有真实对象的引用，以实现对真实对象的访问控制。<br>举个例子，现在公司一般都有VPN，使我们在家也能访问到公司的内网（比如连接公司的数据库等），实现居家办公。这里VPN相当于一个代理，而公司内网相当于被代理对象，也就是真实对象。我们不能直接访问公司内网（真实对象），但是我们通过VPN（代理对象），输入身份信息，确认无误后就可以访问到公司内网。这就是代理模式的作用—-控制对象的访问。    </li>
<li>2.代理模式的分类</li>
<li>2.1.静态代理<br>该代理对象持有被代理对象的引用，客户端通过调用代理对象的方法间接实现调用真实对象的方法。        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">*People真实对象的接口包含两个方法</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">public interface People &#123;</span><br><span class="line">    voidsayHello(String msg);</span><br><span class="line"> </span><br><span class="line">    voidsayBye(String msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
真实对象接口的具体实现:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Student implements People &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void sayHello(String msg) &#123;</span><br><span class="line">      System.out.println(&quot;Hello &quot;+msg);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void sayBye(String msg) &#123;</span><br><span class="line">        System.out.println(&quot;ByeBye &quot;+msg);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
代理对象:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class StaticProxy implements People&#123;</span><br><span class="line">    &#x2F;&#x2F;真实对象，客户端不能直接访问</span><br><span class="line">    private People people;</span><br><span class="line">    publicStaticProxy()&#123;</span><br><span class="line">        this.people &#x3D; new Student();</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void sayHello(String msg) &#123;</span><br><span class="line">        boolean friendFlag &#x3D; true;</span><br><span class="line">        if(friendFlag)&#123;</span><br><span class="line">            people.sayHello(msg);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;记录访问日志&quot;);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void sayBye(String msg) &#123;</span><br><span class="line">        boolean friendFlag &#x3D; true;</span><br><span class="line">        if(friendFlag)&#123;</span><br><span class="line">            people.sayBye(msg);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;记录访问日志&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/images/proxy1.png" alt="客户端调试及结果"><br>上面就是静态代理的一个实现，通过静态代理，实现了访问控制，但是在每个真实对象方法之前都加入了访问控制代码来验证权限。如果有很多个方法，则要在每个方法调用前都加入验证权限的代码，这样非常的不灵活且有大量的重复代码，即使把验证权限抽象出来做过方法或者类，但是还是得在每个方法前加一段调用权限验证的代码，比如，一个客户端只用其中的一个方法，但是代理中两个方法都要加入权限控制，要满足其他客户端的调用需求，上面接口中只有两个方法还好，但是如果有上百个方法那岂不是很臃肿。那么有什么办法解决了，那就是动态代理       </li>
<li>2.2.动态代理<br>生成动态代理类，而不用像静态代理一样，在编译期间进行定义类。动态代理更加灵活，不用显示的在所有的方法前面或者后面加入权限验证、记录日志等操作。<br>动态代理的实现如下：      </li>
<li><em>其中真实对象接口和它的实现跟静态代理一样的。</em>*<br>不同的是代理类的创建，静态代理是直接新增一个代理类，而动态代理则不是。动态代理是通过JDK的Proxy和一个调用处理器InvocationHandler来实现的，通过Proxy来生成代理类实例，而这个代理实例通过调用处理器InvocationHandler接收不同的参数灵活调用真实对象的方法.<br>所以我们需要做的是穿件调用处理器，该调用处理器必须实现JDK的InvocationHandler        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * </span><br><span class="line"> *DynamicProxyHandler</span><br><span class="line"> * 调用处理器   实现动态代理必不可少的组件</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DynamicProxyHandler implements InvocationHandler &#123;</span><br><span class="line">    private People target;</span><br><span class="line">    public DynamicProxyHandler()&#123;</span><br><span class="line">        this.target&#x3D;new Student();&#x2F;&#x2F;实例化一个真实对象</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args)</span><br><span class="line">            throws Throwable &#123;</span><br><span class="line">        boolean friendFlag&#x3D;true;</span><br><span class="line">        Object o &#x3D; null;</span><br><span class="line">        if(friendFlag)&#123; &#x2F;&#x2F;权限验证通过    所有方法的权限验证只需要在这里加代码就行了</span><br><span class="line">           o &#x3D; method.invoke(target, args); </span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;记录访问日志&quot;);</span><br><span class="line">        return o;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * </span><br><span class="line">     * 通过Proxy动态生成一个代理实例</span><br><span class="line">     *@return</span><br><span class="line">     *return:Object</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Object getProxy()&#123;</span><br><span class="line">        &#x2F;*</span><br><span class="line">         * Proxy.newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span><br><span class="line">         * 方法的第一个参数的作用就是 获取当前类的类加载器,作用是用来生成类的</span><br><span class="line">         * 第二个参数是获取真实对象的所有接口    获取所有接口的目的是用来生成代理的,因为代理要实现所有的接口</span><br><span class="line">         * 第三个参数是 调用处理器  这里传入调用处理器，是因为生成代理实例需要 调用处理器    为什么需要调用处理器，因为生成的代理不能直接调用真实对象的方法,</span><br><span class="line">         * 而是通过调用处理器来调用真实对象的方法，具体就是通过上面定义的DynamicProxyHandler重写父类InvocationHandler的invoke方法</span><br><span class="line">         *&#x2F;</span><br><span class="line">       return  Proxy.newProxyInstance(this.getClass().getClassLoader(), target.getClass().getInterfaces(), this );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
代码解析:<br>方法：方法：Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces, InvocationHandler h)<br>方法的第一个参数ClassLoader是类加载器,作用是用来生成类的<br>第二个参数interfaces是获取真实对象的所有接口，获取所有接口的目的是用来生成代理的,因为代理要实现所有的接口<br>第三个参数InvocationHandler是调用处理器,这里传入调用处理器，是因为生成代理实例需要调用处理器,至于为什么需要调用处理器，是因为生成的代理不能直接调用真实对象的方法,而是通过调用处理器来调用真实对象的方法，具体就是上面DynamicProxyHandler重写父类的InvocationHandler的invoke方法来调用真实对象的方法。为什么是这样，后面再分析，先来看客户端怎么调用<br><img src="/images/proxy2.png" alt="客户端调试及结果"><br>这样则实现了动态代理，客户端调用代理不同的方法，都实现了对真实对象的间接调用，并且经过了代理对象的权限验证。但是我们只在一个地方加入了权限验证的代码，并没有在每个方法前面都加入，这样更加灵活和优雅。但是我们重头到尾都没有看到像静态代理类那样的一个动态代理类，那么JDK的Proxy是怎么得到动态代理类的实例的呢？真的不建立一个类，就能获取该类的实例吗？<br>这是不可能的，Java中必须要有类，才会有该类的实例。其实不是没有代理类，而是JDK在运行期间帮我们生成了一个代理类的字节码，通过类加载器加载这个字节码，然后执行引擎进行一系列处理后生成代理类，再进行实例化。<br>下面就来看JDK是怎么生成代理类并且实例化的:<br>核心代码就是： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Proxy.newProxyInstance(this.getClass().getClassLoader(),target.getClass().getInterfaces(),this );       </span><br></pre></td></tr></table></figure>
看看JDK是怎么生成代理类并且实例化的:<br><img src="/images/proxy3.png" alt="底层实现"><br>通过源码可以知道，生成代理类是通过如下方法实现的：<br>Class&lt;?&gt; cl =getProxyClass(loader, interfaces);<br>再追踪一下，这个方法里面内容很多，但是最关键的就是下面这个方法：          byte[] proxyClassFile = ProxyGenerator.generateProxyClass(                    proxyName, interfaces);        </li>
</ul>
<p>通过这个方法就生成了代理类的字节码，只不过调用完就不存在了。所以我们看不到它的源码。      </p>
<p>我们也可以模拟生成代理类，看看生成的动态代理类到底是个什么东西     </p>
<p>通过如下类就可以生成代理类的字节码       </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * </span><br><span class="line"> *GenerateDynamic</span><br><span class="line"> * 生成代理类字节码的类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class GenerateDynamic &#123;</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       &#x2F;* People p &#x3D; new Student();</span><br><span class="line">        DynamicProxyHandler handler &#x3D; new DynamicProxyHandler();</span><br><span class="line">        People proxy &#x3D; (People) Proxy.newProxyInstance(handler.getClass()</span><br><span class="line">                .getClassLoader(), p.getClass().getInterfaces(), handler);</span><br><span class="line">        proxy.sayBye(&quot;tanggao&quot;);*&#x2F;</span><br><span class="line"> </span><br><span class="line">        createProxyClassFile();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private static void createProxyClassFile() &#123;</span><br><span class="line">        String name &#x3D; &quot;ProxySubject&quot;;</span><br><span class="line">        byte[] data &#x3D; ProxyGenerator.generateProxyClass(name,</span><br><span class="line">                new Class[] &#123; People.class &#125;);</span><br><span class="line">        FileOutputStream out &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            out &#x3D; new FileOutputStream(name + &quot;.class&quot;);</span><br><span class="line">            System.out.println((new File(&quot;hello&quot;)).getAbsolutePath());</span><br><span class="line">            out.write(data);</span><br><span class="line">        &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        finally &#123;</span><br><span class="line">            if (null !&#x3D; out)</span><br><span class="line">                try &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用反编译工具查看一下生成的字节码，先上代码，后面再分析：        </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">import com.dynamic.test.People;</span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"> </span><br><span class="line">public final class ProxySubject extends Proxy</span><br><span class="line">  implements People</span><br><span class="line">&#123;</span><br><span class="line">  private static Method m1;</span><br><span class="line">  private static Method m3;</span><br><span class="line">  private static Method m4;</span><br><span class="line">  private static Method m0;</span><br><span class="line">  private static Method m2;</span><br><span class="line"> </span><br><span class="line">  public ProxySubject(InvocationHandler paramInvocationHandler)</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    super(paramInvocationHandler);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public final boolean equals(Object paramObject)</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      return ((Boolean)this.h.invoke(this, m1, new Object[] &#123; paramObject &#125;)).booleanValue();</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Error|RuntimeException localError)</span><br><span class="line">    &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Throwable localThrowable)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public final void sayBye(String paramString)</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      this.h.invoke(this, m3, new Object[] &#123; paramString &#125;);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Error|RuntimeException localError)</span><br><span class="line">    &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Throwable localThrowable)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public final void sayHello(String paramString)</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      this.h.invoke(this, m4, new Object[] &#123; paramString &#125;);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Error|RuntimeException localError)</span><br><span class="line">    &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Throwable localThrowable)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public final int hashCode()</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      return ((Integer)this.h.invoke(this, m0, null)).intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Error|RuntimeException localError)</span><br><span class="line">    &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Throwable localThrowable)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public final String toString()</span><br><span class="line">    throws </span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      return (String)this.h.invoke(this, m2, null);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Error|RuntimeException localError)</span><br><span class="line">    &#123;</span><br><span class="line">      throw localError;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Throwable localThrowable)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new UndeclaredThrowableException(localThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  static</span><br><span class="line">  &#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">      m1 &#x3D; Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, new Class[] &#123; Class.forName(&quot;java.lang.Object&quot;) &#125;);</span><br><span class="line">      m3 &#x3D; Class.forName(&quot;com.dynamic.test.People&quot;).getMethod(&quot;sayBye&quot;, new Class[] &#123; Class.forName(&quot;java.lang.String&quot;) &#125;);</span><br><span class="line">      m4 &#x3D; Class.forName(&quot;com.dynamic.test.People&quot;).getMethod(&quot;sayHello&quot;, new Class[] &#123; Class.forName(&quot;java.lang.String&quot;) &#125;);</span><br><span class="line">      m0 &#x3D; Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]);</span><br><span class="line">      m2 &#x3D; Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (NoSuchMethodException localNoSuchMethodException)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new NoSuchMethodError(localNoSuchMethodException.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    catch (ClassNotFoundException localClassNotFoundException)</span><br><span class="line">    &#123;</span><br><span class="line">      throw new NoClassDefFoundError(localClassNotFoundException.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/proxy5.png" alt="动态代理源码分析"><br><img src="/images/proxy4.png" alt="动态代理源码分析"><br>动态代理是通过调用处理器的invoke方法来调用真实对象的方法，而这个invoke方法就是我们自己覆写的方法<br>可以看出是通过反射实现的，通过传入的不同的方法对象和参数来调用真实对象的不同方法。刚开始我和网上很多人一样都有一个疑问，对于invoke方法发参数，Method和args在我们覆写的invoke方法中都有用到，但是对于第一个参数，代理对象proxy没有用，所以不知道这个东西调用处理器传给我们有什么用，最后通过谷歌和百度搜索发现，网上也有人和我有一样的疑问      </p>
<ul>
<li>第一个参数 Object proxy的使用：        </li>
</ul>
<p>1.可以使用反射获取代理对象的信息（也就是proxy.getClass().getName()）。<br>2.可以将代理对象返回以进行连续调用，这就是proxy存在的目的。因为this并不是代理对象，     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public interface Account &#123;</span><br><span class="line">    public Account deposit (double value);</span><br><span class="line">    public double getBalance ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ExampleInvocationHandler implements InvocationHandler &#123;</span><br><span class="line"> </span><br><span class="line">    private double balance;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke (Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; simplified method checks, would need to check the parameter count and types too</span><br><span class="line">        if (&quot;deposit&quot;.equals(method.getName())) &#123;</span><br><span class="line">            Double value &#x3D; (Double) args[0];</span><br><span class="line">            System.out.println(&quot;deposit: &quot; + value);</span><br><span class="line">            balance +&#x3D; value;</span><br><span class="line">            return proxy; &#x2F;&#x2F; here we use the proxy to return &#39;this&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        if (&quot;getBalance&quot;.equals(method.getName())) &#123;</span><br><span class="line">            return balance;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试调用</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line"> </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * description:</span><br><span class="line">     *</span><br><span class="line">     * @param args</span><br><span class="line">     * @author:tanggao</span><br><span class="line">     * @date:2017-9-28 下午2:42:00 return:void</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Account account &#x3D; (Account) Proxy.newProxyInstance(Account.class</span><br><span class="line">                .getClassLoader(), new Class[] &#123; Account.class,</span><br><span class="line">                Serializable.class &#125;, new ExampleInvocationHandler());</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; method chaining for the win!</span><br><span class="line">        account.deposit(5000).deposit(4000).deposit(-2500);</span><br><span class="line">        System.out.println(&quot;Balance: &quot; + account.getBalance());</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们看到如果返回proxy的话可以对该代理对象进行连续调用   </p>
<p>那为什么不返回this，而是返回proxy对象呢？   </p>
<p>因为this对象的类型是ExampleInvocationHandler，而不是代理类$Proxy0           </p>
<h4 id="4-搭建自定义Mybatis环境"><a href="#4-搭建自定义Mybatis环境" class="headerlink" title="4.搭建自定义Mybatis环境"></a>4.搭建自定义Mybatis环境</h4><ul>
<li>1.创建Maven工程<br>把pom.xml的mybatis配置去掉加上jaxen配置:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis_ retrospect&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">&lt;!--        &lt;dependency&gt;--&gt;</span><br><span class="line">&lt;!--            &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;--&gt;</span><br><span class="line">&lt;!--            &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;--&gt;</span><br><span class="line">&lt;!--            &lt;version&gt;3.4.5&lt;&#x2F;version&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;&#x2F;dependency&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.12&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;dom4j&lt;&#x2F;groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;dom4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">           &lt;version&gt;1.6.1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li>2.上一个Maven工程内容不变的情况下加入一个mybatis包并在包下新建一些需要的配置类包<br><img src="/images/mybatis5.png" alt="img">               </li>
<li>3.在cfg包下编写Configuration和Mapper类<br>Configuration类代码:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.cfg;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 自定义mybatis配置类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Configuration &#123;</span><br><span class="line">    private String driver;</span><br><span class="line">    private String url;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Map&lt;String,Mapper&gt; mappers &#x3D; new HashMap&lt;String, Mapper&gt;();</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Mapper&gt; getMappers() &#123;</span><br><span class="line">        return mappers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMappers(Map&lt;String, Mapper&gt; mappers) &#123;</span><br><span class="line">        this.mappers &#x3D; mappers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDriver() &#123;</span><br><span class="line">        return driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDriver(String driver) &#123;</span><br><span class="line">        this.driver &#x3D; driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUrl() &#123;</span><br><span class="line">        return url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUrl(String url) &#123;</span><br><span class="line">        this.url &#x3D; url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsername(String username) &#123;</span><br><span class="line">        this.username &#x3D; username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPassword(String password) &#123;</span><br><span class="line">        this.password &#x3D; password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
Mapper类     <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.cfg;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用于封装执行的SQL语句和结果类型的全限定类名</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Mapper &#123;</span><br><span class="line">    private String queryString;&#x2F;&#x2F;SQL</span><br><span class="line">    private String resultType;&#x2F;&#x2F;实体类的全限定类名</span><br><span class="line"></span><br><span class="line">    public String getQueryString() &#123;</span><br><span class="line">        return queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setQueryString(String queryString) &#123;</span><br><span class="line">        this.queryString &#x3D; queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getResultType() &#123;</span><br><span class="line">        return resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResultType(String resultType) &#123;</span><br><span class="line">        this.resultType &#x3D; resultType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>4.在io包下面编写一个加载配置文件的类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.io;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 使用类加载器读取配置文件的类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Resources &#123;</span><br><span class="line"></span><br><span class="line">    public static InputStream getResourceAsStream(String filePath)&#123;</span><br><span class="line">        return Resources.class.getClassLoader().getResourceAsStream(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>5.在annotation包下面编写Select注解类用于解析方法上面配置的注解<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.annotations;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">&#x2F;***</span><br><span class="line"> * 查询的注解</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">public @interface Select &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 配置SQL语句的</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    String value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>6.编写配置文件解析类：把配置文件中的配置信息加载到Configuration和Mapper中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.utils;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.annotations.Select;</span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line">import com.itfeifei.mybatis.cfg.Mapper;</span><br><span class="line">import com.itfeifei.mybatis.io.Resources;</span><br><span class="line">import org.dom4j.Attribute;</span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentException;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.ParameterizedType;</span><br><span class="line">import java.lang.reflect.Type;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 解析配置文件</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class XMLConfigBuilder &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 解析主配置文件，把里面的内容填充到DefaultSqlSession所需要的地方</span><br><span class="line">     * 使用的 技术为： dom4j + xpath</span><br><span class="line">     * @param config</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Configuration loadConfiguration(InputStream config)&#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;定义封装连接信息的配置对象（mybatis的配置对象）</span><br><span class="line">            Configuration cfg &#x3D; new Configuration();</span><br><span class="line">            &#x2F;&#x2F;1.获取SAXReader对象</span><br><span class="line">            SAXReader reader &#x3D; new SAXReader();</span><br><span class="line">            &#x2F;&#x2F;2.根据字节输入流获取Document对象</span><br><span class="line">            Document document &#x3D; reader.read(config);</span><br><span class="line">            &#x2F;&#x2F;3.获取根节点</span><br><span class="line">            Element rootElement &#x3D; document.getRootElement();</span><br><span class="line">            &#x2F;&#x2F;4.使用xpath中选择指定节点的方式，获取所有的property节点</span><br><span class="line">            List&lt;Element&gt; propertyElements &#x3D; rootElement.selectNodes(&quot;&#x2F;&#x2F;property&quot;);</span><br><span class="line">            &#x2F;&#x2F;5.遍历节点</span><br><span class="line">            for (Element propertyElement : propertyElements)&#123;</span><br><span class="line">                &#x2F;&#x2F;判断节点是连接数据库的那部分信息</span><br><span class="line">                &#x2F;&#x2F;取出name属性的值</span><br><span class="line">                String name &#x3D; propertyElement.attributeValue(&quot;name&quot;);</span><br><span class="line">                if(&quot;driver&quot;.equals(name))&#123;</span><br><span class="line">                    &#x2F;&#x2F;表示驱动</span><br><span class="line">                    &#x2F;&#x2F;获取property标签value属性的值</span><br><span class="line">                    String driver &#x3D; propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setDriver(driver);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;url&quot;.equals(name))&#123;</span><br><span class="line">                    &#x2F;&#x2F;表示连接字符串</span><br><span class="line">                    &#x2F;&#x2F;获取property标签value属性的值</span><br><span class="line">                    String url &#x3D; propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setUrl(url);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;username&quot;.equals(name))&#123;</span><br><span class="line">                    &#x2F;&#x2F;表示用户名</span><br><span class="line">                    &#x2F;&#x2F;获取property标签value属性的值</span><br><span class="line">                    String username &#x3D; propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setUsername(username);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;password&quot;.equals(name))&#123;</span><br><span class="line">                    &#x2F;&#x2F;表示密码</span><br><span class="line">                    &#x2F;&#x2F;获取property标签value属性的值</span><br><span class="line">                    String password &#x3D; propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setPassword(password);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;取出mappers中所有的mapper标签，判断他们使用了resource还是class属性</span><br><span class="line">            List&lt;Element&gt; mapperElements &#x3D; rootElement.selectNodes(&quot;&#x2F;&#x2F;mappers&#x2F;mapper&quot;);</span><br><span class="line">            &#x2F;&#x2F;遍历集合</span><br><span class="line">            for (Element mapperElement : mapperElements)&#123;</span><br><span class="line">                &#x2F;&#x2F;判断mapperElement使用的是哪个属性</span><br><span class="line">                Attribute attribute &#x3D; mapperElement.attribute(&quot;resource&quot;);</span><br><span class="line">                if (attribute !&#x3D; null)&#123;</span><br><span class="line">                    System.out.println(&quot;使用的是XML&quot;);</span><br><span class="line">                    &#x2F;&#x2F;表示resource属性，使用的是xml</span><br><span class="line">                    &#x2F;&#x2F;取出属性的值</span><br><span class="line">                    String mapperPath &#x3D; attribute.getValue();&#x2F;&#x2F;获取属性的值&quot;com&#x2F;itfeifei&#x2F;dao&#x2F;IUserDao.xml&quot;</span><br><span class="line">                    &#x2F;&#x2F;把映射配置文件的内容取出来，封装成一个map</span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers &#x3D; loadMapperConfiguration(mapperPath);</span><br><span class="line">                    &#x2F;&#x2F;给configuration中的mappers赋值</span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    System.out.println(&quot;使用的是注解&quot;);</span><br><span class="line">                    &#x2F;&#x2F;表示没有resource属性，用的是注解</span><br><span class="line">                    &#x2F;&#x2F;获取class属性的值</span><br><span class="line">                    String daoClassPath &#x3D; mapperElement.attributeValue(&quot;class&quot;);</span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers &#x3D; loadMapperAnnotation(daoClassPath);</span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return cfg;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                config.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据传入的参数，解析xml，并封装到Map中</span><br><span class="line">     * @param mapperPath        映射配置文件的位置</span><br><span class="line">     * @return  map中包含了获取的唯一标识(key是由dao的全限定类名和方法名组成的)</span><br><span class="line">     *          以及执行所需要的必要信息（value是一个Mapper对象，里面存放的是执行SQL语句和要封装实体类全限定类名）</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;String,Mapper&gt; loadMapperConfiguration(String mapperPath) throws IOException &#123;</span><br><span class="line">        InputStream in &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;定义要返回的对象</span><br><span class="line">            Map&lt;String,Mapper&gt; mappers &#x3D; new HashMap&lt;String, Mapper&gt;();</span><br><span class="line">            &#x2F;&#x2F;1.根据路径获取字节输入流</span><br><span class="line">            in &#x3D; Resources.getResourceAsStream(mapperPath);</span><br><span class="line">            &#x2F;&#x2F;2.根据字节输入流获取Document对象</span><br><span class="line">            SAXReader reader &#x3D; new SAXReader();</span><br><span class="line">            Document document &#x3D; reader.read(in);</span><br><span class="line">            &#x2F;&#x2F;3.获取根节点</span><br><span class="line">            Element rootElement &#x3D; document.getRootElement();</span><br><span class="line">            &#x2F;&#x2F;4.获取根节点的namespace属性取值</span><br><span class="line">            String namespace &#x3D; rootElement.attributeValue(&quot;namespace&quot;);</span><br><span class="line">            &#x2F;&#x2F;5.获取所有的select节点</span><br><span class="line">            List&lt;Element&gt; selectElements &#x3D; rootElement.selectNodes(&quot;&#x2F;&#x2F;select&quot;);</span><br><span class="line">            &#x2F;&#x2F;6.遍历所有的select节点</span><br><span class="line">            for (Element selectElement : selectElements)&#123;</span><br><span class="line">                &#x2F;&#x2F;取出id 的属性值 组成map中key的部分</span><br><span class="line">                String id &#x3D; selectElement.attributeValue(&quot;id&quot;);</span><br><span class="line">                &#x2F;&#x2F;取出resultType属性的值 组成map中value的部分</span><br><span class="line">                String resultType &#x3D; selectElement.attributeValue(&quot;resultType&quot;);</span><br><span class="line">                &#x2F;&#x2F;取出文本内容   组成map中的value部分</span><br><span class="line">                String queryString &#x3D; selectElement.getText();</span><br><span class="line">                &#x2F;&#x2F;创建key</span><br><span class="line">                String key &#x3D; namespace + &quot;.&quot; + id;</span><br><span class="line">                &#x2F;&#x2F;创建value</span><br><span class="line">                Mapper mapper &#x3D; new Mapper();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                mapper.setResultType(resultType);</span><br><span class="line">                &#x2F;&#x2F;把key和value存入mappers中</span><br><span class="line">                mappers.put(key,mapper);</span><br><span class="line">            &#125;</span><br><span class="line">            return mappers;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据传入的参数，得到dao中所有被select注解标注的方法。</span><br><span class="line">     * 根据方法名称和类名，以及方法上注解value属性的值，组成Mapper的必要信息</span><br><span class="line">     * @param daoClassPath</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;String,Mapper&gt; loadMapperAnnotation(String daoClassPath) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F;定义返回值对象</span><br><span class="line">        Map&lt;String,Mapper&gt; mappers &#x3D; new HashMap&lt;String, Mapper&gt;();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1.得到到接口的字节码对象</span><br><span class="line">        Class&lt;?&gt; daoClass &#x3D; Class.forName(daoClassPath);</span><br><span class="line">        &#x2F;&#x2F;2.得到dao接口中的方法数组</span><br><span class="line">        Method[] methods &#x3D; daoClass.getMethods();</span><br><span class="line">        &#x2F;&#x2F;3.遍历Method数组</span><br><span class="line">        for (Method method : methods)&#123;</span><br><span class="line">            &#x2F;&#x2F;取出每一个方法，判断是否有select注解</span><br><span class="line">            boolean isAnnotated &#x3D; method.isAnnotationPresent(Select.class);</span><br><span class="line">            if (isAnnotated)&#123;</span><br><span class="line">                &#x2F;&#x2F;创建Mapper对象</span><br><span class="line">                Mapper mapper &#x3D; new Mapper();</span><br><span class="line">                &#x2F;&#x2F;取出注解的value属性</span><br><span class="line">                Select selectAnno &#x3D; method.getAnnotation(Select.class);</span><br><span class="line">                String queryString &#x3D; selectAnno.value();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                &#x2F;&#x2F;获取当前方法的返回值，还要求必须带有泛型信息</span><br><span class="line">                Type type &#x3D; method.getGenericReturnType();&#x2F;&#x2F;List&lt;User&gt;</span><br><span class="line">                &#x2F;&#x2F;判断type是不是参数化的类型</span><br><span class="line">                if (type instanceof ParameterizedType)&#123;</span><br><span class="line">                    &#x2F;&#x2F;强转</span><br><span class="line">                    ParameterizedType ptype &#x3D; (ParameterizedType)type;</span><br><span class="line">                    &#x2F;&#x2F;得到参数化类型中的实际参数</span><br><span class="line">                    Type[] types &#x3D; ptype.getActualTypeArguments();</span><br><span class="line">                    &#x2F;&#x2F;取出第一个</span><br><span class="line">                    Class domainClass &#x3D; (Class)types[0];</span><br><span class="line">                    &#x2F;&#x2F;获取domainClass的类名</span><br><span class="line">                    String resultType &#x3D; domainClass.getName();</span><br><span class="line">                    &#x2F;&#x2F;给Mapper赋值</span><br><span class="line">                    mapper.setResultType(resultType);</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;组装key信息</span><br><span class="line">                String key &#x3D; method.getDeclaringClass().getName() + &quot;.&quot; + method.getName();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                &#x2F;&#x2F;给map赋值</span><br><span class="line">                mappers.put(key,mapper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mappers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>7.编写负责执行SQL语句的，并且封装结果集的类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.utils;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Mapper;</span><br><span class="line"></span><br><span class="line">import java.beans.PropertyDescriptor;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.sql.*;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 负责执行SQL语句，并且封装结果集</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Executor &#123;</span><br><span class="line">    public &lt;E&gt; List&lt;E&gt; selectList(Mapper mapper, Connection connection)&#123;</span><br><span class="line">        PreparedStatement pstm &#x3D; null;</span><br><span class="line">        ResultSet rs &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;1.取出mapper中的数据</span><br><span class="line">            String queryString &#x3D; mapper.getQueryString();</span><br><span class="line">            String resultType &#x3D; mapper.getResultType();</span><br><span class="line">            Class domainClass &#x3D; Class.forName(resultType);</span><br><span class="line">            &#x2F;&#x2F;2.获取PreparedStatement</span><br><span class="line">            pstm &#x3D; connection.prepareStatement(queryString);</span><br><span class="line">            &#x2F;&#x2F;3.执行SQL语句，获取结果集</span><br><span class="line">            rs &#x3D; pstm.executeQuery();</span><br><span class="line">            &#x2F;&#x2F;4.封装结果集</span><br><span class="line">            List&lt;E&gt; list &#x3D; new ArrayList&lt;E&gt;();&#x2F;&#x2F;定义返回值</span><br><span class="line">            while (rs.next())&#123;</span><br><span class="line">                &#x2F;&#x2F;实例化要封装的实体类对象</span><br><span class="line">                E obj &#x3D; (E)domainClass.newInstance();</span><br><span class="line">                &#x2F;&#x2F;取出结果集的元信息：ResultSetMetaData</span><br><span class="line">                ResultSetMetaData metaData &#x3D; rs.getMetaData();</span><br><span class="line">                &#x2F;&#x2F;取出总列数</span><br><span class="line">                int columnCount &#x3D; metaData.getColumnCount();</span><br><span class="line">                &#x2F;&#x2F;遍历总列数</span><br><span class="line">                for (int i &#x3D; 1; i&lt;&#x3D; columnCount; i++)&#123;</span><br><span class="line">                    &#x2F;&#x2F;获取每列的名称，列明的序号是从1开始的</span><br><span class="line">                    String columnName &#x3D; metaData.getColumnLabel(i);</span><br><span class="line">                    &#x2F;&#x2F;根据得到的列名，获取每列的值</span><br><span class="line">                    Object columnValue &#x3D; rs.getObject(i);</span><br><span class="line">                    &#x2F;&#x2F;给obj赋值:使用Java内省机制（借助PropertyDescriptor实现属性的封装）</span><br><span class="line">                    PropertyDescriptor pd &#x3D; new PropertyDescriptor(columnName, domainClass);</span><br><span class="line">                    &#x2F;&#x2F;获取它的写入方法</span><br><span class="line">                    Method writeMethod &#x3D; pd.getWriteMethod();</span><br><span class="line">                    &#x2F;&#x2F;把获取的列的值，给对象赋值</span><br><span class="line">                    writeMethod.invoke(obj,columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;把赋好值的对象加入到集合里面</span><br><span class="line">                list.add(obj);</span><br><span class="line">            &#125;</span><br><span class="line">            return list;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 资源关闭操作</span><br><span class="line">     * @param pstm</span><br><span class="line">     * @param rs</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void release(PreparedStatement pstm,ResultSet rs)&#123;</span><br><span class="line">        if (rs !&#x3D; null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; catch (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (pstm !&#x3D; null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                pstm.close();</span><br><span class="line">            &#125; catch (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>8.编写创建连接的工具类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用于创建数据源的工具类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DataSourceUtil &#123;</span><br><span class="line">    public static Connection getConnection(Configuration cfg)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class.forName(cfg.getDriver());</span><br><span class="line">            return DriverManager.getConnection(cfg.getUrl(),cfg.getUsername(),cfg.getPassword());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>9.编写sqlsession包下面的类<br>SqlSession接口和SqlSessionFactory接口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用于创建数据源的工具类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DataSourceUtil &#123;</span><br><span class="line">    public static Connection getConnection(Configuration cfg)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class.forName(cfg.getDriver());</span><br><span class="line">            return DriverManager.getConnection(cfg.getUrl(),cfg.getUsername(),cfg.getPassword());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.itfeifei.mybatis.sqlsession;</span><br><span class="line"></span><br><span class="line">public interface SqlSessionFactory &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 用于创建一个新的SqlSession对象</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    SqlSession openSession();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
在sqlsession包下创建一个defaults包写如下类:<br>SqlSession接口的实现类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.sqlsession.defaults;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.proxy.MapperProxy;</span><br><span class="line">import com.itfeifei.mybatis.utils.DataSourceUtil;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * SqlSession接口的实现类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DefaultSqlSession implements SqlSession&#123;</span><br><span class="line">    private Configuration configuration;</span><br><span class="line">    private Connection connection;</span><br><span class="line"></span><br><span class="line">    public DefaultSqlSession(Configuration configuration) &#123;</span><br><span class="line">        this.configuration &#x3D; configuration;</span><br><span class="line">        connection &#x3D; DataSourceUtil.getConnection(configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     *用于创建代理对象</span><br><span class="line">     * @param daoInterfaceClass</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public &lt;T&gt; T getMapper(Class&lt;T&gt; daoInterfaceClass) &#123;</span><br><span class="line">        return (T) Proxy.newProxyInstance(daoInterfaceClass.getClassLoader(),new Class[]&#123;daoInterfaceClass&#125;,new MapperProxy(configuration.getMappers(),connection));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 释放资源</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void close() &#123;</span><br><span class="line">        if (connection !&#x3D; null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; catch (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
SqlSessionFactory接口的实现类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.sqlsession.defaults;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line">public class DefaultSqlSessionFactory implements SqlSessionFactory &#123;</span><br><span class="line">    private Configuration configuration;</span><br><span class="line"></span><br><span class="line">    public DefaultSqlSessionFactory(Configuration configuration) &#123;</span><br><span class="line">        this.configuration &#x3D; configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public SqlSession openSession() &#123;</span><br><span class="line">        return new DefaultSqlSession(configuration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
然后在sqlsession包下面写一个SqlSessionFactoryBuilder类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.sqlsession;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.defaults.DefaultSqlSessionFactory;</span><br><span class="line">import com.itfeifei.mybatis.utils.XMLConfigBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用于创建一个SqlSessionFactory对象</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line">    public SqlSessionFactory build(InputStream in)&#123;</span><br><span class="line">        Configuration cfg &#x3D; XMLConfigBuilder.loadConfiguration(in);</span><br><span class="line">        return new DefaultSqlSessionFactory(cfg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>10.编写代理类需要实现InvocationHandler接口并且编写invoke增强方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.mybatis.sqlsession.proxy;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.mybatis.cfg.Configuration;</span><br><span class="line">import com.itfeifei.mybatis.cfg.Mapper;</span><br><span class="line">import com.itfeifei.mybatis.utils.Executor;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class MapperProxy implements InvocationHandler &#123;</span><br><span class="line">    private Map&lt;String, Mapper&gt; mappers;</span><br><span class="line">    private Connection connection;</span><br><span class="line"></span><br><span class="line">    public MapperProxy(Map&lt;String, Mapper&gt; mappers, Connection connection) &#123;</span><br><span class="line">        this.mappers &#x3D; mappers;</span><br><span class="line">        this.connection &#x3D; connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     *      用于对方法进行增强的，我们的增强其实就是调用selectList方法</span><br><span class="line">     * @param proxy</span><br><span class="line">     * @param method</span><br><span class="line">     * @param args</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Throwable</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        &#x2F;&#x2F;1.获取方法名</span><br><span class="line">        String methodName &#x3D; method.getName();</span><br><span class="line">        &#x2F;&#x2F;2.获取方法所在的类的名称</span><br><span class="line">        String className &#x3D; method.getDeclaringClass().getName();</span><br><span class="line">        &#x2F;&#x2F;3.组合key</span><br><span class="line">        String key &#x3D; className + &quot;.&quot; + methodName;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;4.获取mappers中的Mapper对象</span><br><span class="line">        Mapper mapper &#x3D; mappers.get(key);</span><br><span class="line">        &#x2F;&#x2F;5.判断是否有mapper</span><br><span class="line">        if (mapper &#x3D;&#x3D; null)&#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;传入的参数有误&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;6.调用工具类执行查询</span><br><span class="line">        return new Executor().selectList(mapper,connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>11.最后编写测试类测试代码<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.test;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.dao.IUserDao;</span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line">import com.itfeifei.mybatis.io.Resources;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSessionFactory;</span><br><span class="line">import com.itfeifei.mybatis.sqlsession.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class MybatisTest &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        InputStream in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sessionFactory &#x3D; builder.build(in);</span><br><span class="line">        SqlSession session &#x3D; sessionFactory.openSession();</span><br><span class="line">        IUserDao userDao &#x3D; session.getMapper(IUserDao.class);</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">        for (User user : users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/images/mybatis6.png" alt="运行结果">       </li>
<li><em>注意SqlMapConfig.xml和IUserDao.xml配置文件中的mybatis声明需要去掉不然会报错</em>*<h2 id="Step-4-Mybatis框架下的CRUD操作"><a href="#Step-4-Mybatis框架下的CRUD操作" class="headerlink" title="#Step 4: Mybatis框架下的CRUD操作"></a>#Step 4: Mybatis框架下的CRUD操作</h2></li>
</ul>
<hr>
<h4 id="1-先创建一个Maven工程"><a href="#1-先创建一个Maven工程" class="headerlink" title="1.先创建一个Maven工程"></a>1.先创建一个Maven工程</h4><h4 id="2-编写pom-xml配置"><a href="#2-编写pom-xml配置" class="headerlink" title="2.编写pom.xml配置"></a>2.编写pom.xml配置</h4><h4 id="3-在com-itfeifei-domain包下创建一个JavaBean-User类"><a href="#3-在com-itfeifei-domain包下创建一个JavaBean-User类" class="headerlink" title="3.在com.itfeifei.domain包下创建一个JavaBean  User类"></a>3.在com.itfeifei.domain包下创建一个JavaBean  User类</h4><p><strong>注意User类需要实现一个Serializable</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String userName;</span><br><span class="line">    private String address;</span><br><span class="line">    private String sex;</span><br><span class="line">    private Date birthday;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Integer id) &#123;</span><br><span class="line">        this.id &#x3D; id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName &#x3D; userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address &#x3D; address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex &#x3D; sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getBirthday() &#123;</span><br><span class="line">        return birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBirthday(Date birthday) &#123;</span><br><span class="line">        this.birthday &#x3D; birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id&#x3D;&quot; + id +</span><br><span class="line">                &quot;, userName&#x3D;&#39;&quot; + userName + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, address&#x3D;&#39;&quot; + address + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, sex&#x3D;&#39;&quot; + sex + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, birthday&#x3D;&quot; + birthday +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-编写一个com-itfeifei-dao-IUserDao的类"><a href="#4-编写一个com-itfeifei-dao-IUserDao的类" class="headerlink" title="4.编写一个com.itfeifei.dao.IUserDao的类"></a>4.编写一个com.itfeifei.dao.IUserDao的类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.dao;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用户的持久层接口</span><br><span class="line"> *&#x2F;</span><br><span class="line">public interface IUserDao &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存用户操作</span><br><span class="line">     * @param user</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void save(User user);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 修改操作</span><br><span class="line">     * @param user</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void updateUser(User user);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除用户</span><br><span class="line">     * @param id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void deleteUser(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-在Resources目录下面编写配置文件"><a href="#5-在Resources目录下面编写配置文件" class="headerlink" title="5.在Resources目录下面编写配置文件"></a>5.在Resources目录下面编写配置文件</h4><p>创建com文件夹,在com文件夹下面创建itfeifei文件夹再在itfeifei文件夹下创建一个dao文件夹dao文件夹中写IUserDao.xml配置文件<br><strong>IUserDao.xml目录与IUserDao接口一样名字也一样</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.itfeifei.dao.IUserDao&quot;&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id&#x3D;&quot;save&quot; parameterType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        insert into user(username,sex,address,birthday) values (#&#123;userName&#125;,#&#123;sex&#125;,#&#123;address&#125;,#&#123;birthday&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id&#x3D;&quot;updateUser&quot; parameterType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        update user set username &#x3D; #&#123;userName&#125;, address &#x3D; #&#123;address&#125; where id &#x3D; #&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;delete id&#x3D;&quot;deleteUser&quot; parameterType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        delete from user where id &#x3D; #&#123;uId&#125;</span><br><span class="line">    &lt;&#x2F;delete&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>
<p>在Resources下编写SqlMapConfig.xml配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&gt;&lt;&#x2F;transactionManager&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;eesy_mybatis&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;112244&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;itfeifei&#x2F;dao&#x2F;IUserDao.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>
<h4 id="6-编写测试类-注意使用-Before-和-After可以减少代码的冗余"><a href="#6-编写测试类-注意使用-Before-和-After可以减少代码的冗余" class="headerlink" title="6.编写测试类:注意使用@Before  和 @After可以减少代码的冗余"></a>6.编写测试类:注意使用@Before  和 @After可以减少代码的冗余</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.test;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.dao.IUserDao;</span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class MybatisCRUD &#123;</span><br><span class="line">    &#x2F;&#x2F;如果这样写测试多个方法就会产出很对的冗余代码需要修改</span><br><span class="line">&#x2F;&#x2F;    @Test</span><br><span class="line">&#x2F;&#x2F;    public void findAllTest() throws IOException &#123;</span><br><span class="line">&#x2F;&#x2F;        InputStream in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">&#x2F;&#x2F;        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">&#x2F;&#x2F;        SqlSessionFactory sessionFactory &#x3D; builder.build(in);</span><br><span class="line">&#x2F;&#x2F;        SqlSession session &#x3D; sessionFactory.openSession();</span><br><span class="line">&#x2F;&#x2F;        IUserDao userDao &#x3D; session.getMapper(IUserDao.class);</span><br><span class="line">&#x2F;&#x2F;        List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">&#x2F;&#x2F;        for (User user : users)&#123;</span><br><span class="line">&#x2F;&#x2F;            System.out.println(user);</span><br><span class="line">&#x2F;&#x2F;        &#125;</span><br><span class="line">&#x2F;&#x2F;        session.close();</span><br><span class="line">&#x2F;&#x2F;        in.close();</span><br><span class="line">&#x2F;&#x2F;    &#125;</span><br><span class="line">    &#x2F;*修改前需要知道java里面有两个方法注解</span><br><span class="line">            1.Before表示在所有方法运行前运行</span><br><span class="line">            2.After表示在所有方法运行后运行</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private InputStream in;</span><br><span class="line">    private IUserDao userDao;</span><br><span class="line">    private SqlSession session;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory sqlSessionFactory &#x3D; builder.build(in);</span><br><span class="line">        session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        userDao &#x3D; session.getMapper(IUserDao.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void close() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;需要提交事务不然插入，更新，删除操作就不会更新的数据库上</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 测试查询</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findAll()&#123;</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">        for (User user : users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 测试增加用户</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void saveTest()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setSex(&quot;男&quot;);</span><br><span class="line">        user.setUserName(&quot;feifei&quot;);</span><br><span class="line">        user.setAddress(&quot;芜湖&quot;);</span><br><span class="line">        user.setBirthday(new Date());</span><br><span class="line">        userDao.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 更新操作</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void updateTest()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setId(52);</span><br><span class="line">        user.setUserName(&quot;hhh&quot;);</span><br><span class="line">        user.setAddress(&quot;阜阳&quot;);</span><br><span class="line"></span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除测试</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void deleteTest()&#123;</span><br><span class="line">        int i &#x3D; 51;</span><br><span class="line">        userDao.deleteUser(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-用户模糊查询"><a href="#7-用户模糊查询" class="headerlink" title="7.用户模糊查询"></a>7.用户模糊查询</h4><h5 id="在持久层接口添加模糊查询方法"><a href="#在持久层接口添加模糊查询方法" class="headerlink" title="在持久层接口添加模糊查询方法"></a>在持久层接口添加模糊查询方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 模糊查询根据姓名查询</span><br><span class="line">     * @param username</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;User&gt; findByName(String username);</span><br></pre></td></tr></table></figure>
<h5 id="在用户的映射文件中配置"><a href="#在用户的映射文件中配置" class="headerlink" title="在用户的映射文件中配置"></a>在用户的映射文件中配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;String&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        select * from user where username like #&#123;uname&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
<h5 id="加入测试方法"><a href="#加入测试方法" class="headerlink" title="加入测试方法"></a>加入测试方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 模糊查询通过姓名查找</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void findByNameTest()&#123;</span><br><span class="line">    List&lt;User&gt; users &#x3D; userDao.findByName(&quot;%老%&quot;);</span><br><span class="line">    for(User user : users)&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="模糊查询的另一种配置方式"><a href="#模糊查询的另一种配置方式" class="headerlink" title="模糊查询的另一种配置方式"></a>模糊查询的另一种配置方式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username like &#39;%$&#123;value&#125;%&#39;</span><br><span class="line"></span><br><span class="line"> &#x2F;**</span><br><span class="line">     * 模糊查询通过姓名查找</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findByNameTest()&#123;</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findByName(&quot;老&quot;);</span><br><span class="line">        for(User user : users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>#{uname} 跟 ‘%${values}%’区别</strong>    </li>
<li><em>#{}表示一个占位符号</em>*<br>通过#{}可以实现 preparedStatement 向占位符中设置值，自动进行 java 类型和 jdbc 类型转换，</li>
<li>*#{}**可以有效防止 sql 注入。 #{}可以接收简单类型值或 pojo 属性值。 如果 parameterType 传输单个简单类<br>型值，#{}括号中可以是 value 或其它名称。<br>${value}<br>${}表示拼接 sql 串<br>通过${}可以将 parameterType 传入的内容拼接在 sql 中且不进行 jdbc 类型转换， ${}可以接收简<br>单类型值或 pojo 属性值，如果 parameterType 传输单个简单类型值，${}括号中只能是 value。          <h4 id="8-查询使用聚合函数"><a href="#8-查询使用聚合函数" class="headerlink" title="8.查询使用聚合函数"></a>8.查询使用聚合函数</h4>dao接口添加方法   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 查询总记录条数</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Integer findTotal();</span><br></pre></td></tr></table></figure>
配置文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findTotal&quot; resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        select count(*) from user;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
测试方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 使用聚合函数查询</span><br><span class="line">     * 查询总记录条数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findTotalTest()&#123;</span><br><span class="line">        int total &#x3D; userDao.findTotal();</span><br><span class="line">        System.out.println(total);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-Mybatis与JDBC的比较"><a href="#9-Mybatis与JDBC的比较" class="headerlink" title="9.Mybatis与JDBC的比较"></a>9.Mybatis与JDBC的比较</h4></li>
</ul>
<p>1.数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。<br>解决：<br>在 SqlMapConfig.xml 中配置数据链接池，使用连接池管理数据库链接。<br>2.Sql 语句写在代码中造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java 代码。<br>解决：<br>将 Sql 语句配置在 XXXXmapper.xml 文件中与 java 代码分离。<br>3.向 sql 语句传参数麻烦，因为 sql 语句的 where 条件不一定，可能多也可能少，占位符需要和参数对应。<br>解决：<br>Mybatis 自动将 java 对象映射至 sql 语句，通过 statement 中的 parameterType 定义输入参数的<br>类型。<br>4.对结果集解析麻烦，sql 变化导致解析代码变化，且解析前需要遍历，如果能将数据库记录封装成 pojo 对<br>象解析比较方便。<br>解决：<br>Mybatis 自动将 sql 执行结果映射至 java 对象，通过 statement 中的 resultType 定义输出结果的<br>类型。</p>
<h2 id="Step-5-Mybatis中的参数深入"><a href="#Step-5-Mybatis中的参数深入" class="headerlink" title="#Step 5: Mybatis中的参数深入"></a>#Step 5: Mybatis中的参数深入</h2><h4 id="1-parameterType参数深入："><a href="#1-parameterType参数深入：" class="headerlink" title="1.parameterType参数深入："></a>1.parameterType参数深入：</h4><h5 id="1-1-使用说明"><a href="#1-1-使用说明" class="headerlink" title="1.1.使用说明"></a>1.1.使用说明</h5><p>我们在上一章节中已经介绍了 SQL 语句传参，使用标签的 parameterType 属性来设定。该属性的取值可以<br>是基本类型，引用类型（例如:String 类型），还可以是实体类类型（POJO 类）。同时也可以使用实体类的包装<br>类，本章节将介绍如何使用实体类的包装类作为参数传递。      </p>
<h5 id="1-2-注意事项："><a href="#1-2-注意事项：" class="headerlink" title="1.2.注意事项："></a>1.2.注意事项：</h5><p>基 本 类 型 和 String 我 们 可 以 直 接 写 类 型 名 称 ， 也 可 以 使 用 包 名 . 类 名 的 方 式 ， 例 如 ：<br>java.lang.String。<br>实体类类型，目前我们只能使用全限定类名。<br>究其原因，是 mybaits 在加载时已经把常用的数据类型注册了别名，从而我们在使用时可以不写包名，<br>而我们的是实体类并没有注册别名，所以必须写全限定类名。在今天课程的最后一个章节中将讲解如何注册实体类<br>的别名。<br><img src="/images/mybatis7.png" alt="Mybatist官方文档说明"><br>这些都是支持的默认别名。我们也可以从源码角度来看它们分别都是如何定义出来的。<br>可以参考 TypeAliasRegistery.class 的源码。<br><img src="/images/mybatis8.png" alt="Mybatist官方文档说明">     </p>
<h5 id="1-3传递pojo包装对象"><a href="#1-3传递pojo包装对象" class="headerlink" title="1.3传递pojo包装对象"></a>1.3传递pojo包装对象</h5><p>开发中通过 pojo 传递查询条件 ，查询条件是综合的查询条件，不仅包括用户查询条件还包括其它的查<br>询条件（比如将用户购买商品信息也作为查询条件），这时可以使用包装对象传递输入参数。<br>Pojo 类中包含 pojo。<br>需求：根据用户名查询用户信息，查询条件放到 QueryVo 的 user 属性中。       </p>
<h6 id="1-3-1-编写QueryVo"><a href="#1-3-1-编写QueryVo" class="headerlink" title="1.3.1.编写QueryVo"></a>1.3.1.编写QueryVo</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 查询条件对象</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class QueryVo implements Serializable &#123;</span><br><span class="line">    private User user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public User getUser() &#123;</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUser(User user) &#123;</span><br><span class="line">        this.user &#x3D; user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-2编写持久层接口"><a href="#1-3-2编写持久层接口" class="headerlink" title="1.3.2编写持久层接口"></a>1.3.2编写持久层接口</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">   * vo中的条件查询用户</span><br><span class="line">   * @param vo</span><br><span class="line">   * @return</span><br><span class="line">   *&#x2F;</span><br><span class="line">  List&lt;User&gt; findByVo(QueryVo vo);</span><br></pre></td></tr></table></figure>
<h6 id="1-3-3持久层接口的映射文件"><a href="#1-3-3持久层接口的映射文件" class="headerlink" title="1.3.3持久层接口的映射文件"></a>1.3.3持久层接口的映射文件</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findByVo&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot; parameterType&#x3D;&quot;com.itfeifei.domain.QueryVo&quot;&gt;</span><br><span class="line">        select * from user where username like #&#123;user.userName&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-4测试包装类作为参数"><a href="#1-3-4测试包装类作为参数" class="headerlink" title="1.3.4测试包装类作为参数"></a>1.3.4测试包装类作为参数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * 条件查询测试</span><br><span class="line">    *&#x2F;</span><br><span class="line">   @Test</span><br><span class="line">   public void findByVoTest()&#123;</span><br><span class="line">       User user &#x3D; new User();</span><br><span class="line">       user.setUserName(&quot;%王%&quot;);</span><br><span class="line">       QueryVo queryVo &#x3D; new QueryVo();</span><br><span class="line">       queryVo.setUser(user);</span><br><span class="line">       List&lt;User&gt; users &#x3D; userDao.findByVo(queryVo);</span><br><span class="line">       for (User user1 : users)&#123;</span><br><span class="line">           System.out.println(user1);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-resultType参数："><a href="#2-resultType参数：" class="headerlink" title="2.resultType参数："></a>2.resultType参数：</h4><h5 id="1-1使用说明："><a href="#1-1使用说明：" class="headerlink" title="1.1使用说明："></a>1.1使用说明：</h5><p>resultType 属性可以指定结果集的类型，它支持基本类型和实体类类型。<br>我们在前面的 CRUD 案例中已经对此属性进行过应用了。<br>需要注意的是，它和 parameterType 一样，如果注册过类型别名的，可以直接使用别名。没有注册过的必须<br>使用全限定类名。例如：我们的实体类此时必须是全限定类名同时，当是实体类名称是，还有一个要求，实体类中的属性名称必须和查询语句中的列名保持一致，否则无法实现封装。        </p>
<h5 id="1-2示例"><a href="#1-2示例" class="headerlink" title="1.2示例"></a>1.2示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>
<h5 id="1-3特殊情况示例："><a href="#1-3特殊情况示例：" class="headerlink" title="1.3特殊情况示例："></a>1.3特殊情况示例：</h5><h6 id="1-3-1修改实体类"><a href="#1-3-1修改实体类" class="headerlink" title="1.3.1修改实体类"></a>1.3.1修改实体类</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private Integer UserId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private String UserAddress;</span><br><span class="line">    private String UserSex;</span><br><span class="line">    private Date UserBirthday;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;UserId&#x3D;&quot; + UserId +</span><br><span class="line">                &quot;, userName&#x3D;&#39;&quot; + userName + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, UserAddress&#x3D;&#39;&quot; + UserAddress + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, UserSex&#x3D;&#39;&quot; + UserSex + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, UserBirthday&#x3D;&quot; + UserBirthday +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getUserId() &#123;</span><br><span class="line">        return UserId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserId(Integer userId) &#123;</span><br><span class="line">        UserId &#x3D; userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName &#x3D; userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserAddress() &#123;</span><br><span class="line">        return UserAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserAddress(String userAddress) &#123;</span><br><span class="line">        UserAddress &#x3D; userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserSex() &#123;</span><br><span class="line">        return UserSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserSex(String userSex) &#123;</span><br><span class="line">        UserSex &#x3D; userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getUserBirthday() &#123;</span><br><span class="line">        return UserBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserBirthday(Date userBirthday) &#123;</span><br><span class="line">        UserBirthday &#x3D; userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-2findAll方法的执行结果为"><a href="#1-3-2findAll方法的执行结果为" class="headerlink" title="1.3.2findAll方法的执行结果为"></a>1.3.2findAll方法的执行结果为</h6><p><img src="/images/mybatis9.png" alt="执行结果"><br>你会发现查询的字段无法封装到User对象里面<br>原因:<br>mybatis把查询到的数据封装到User里面是根据属性名来找的，userName能封装进去是因为mysql在windows系统下不分大小写</p>
<h6 id="1-3-3解决无法封装的问题："><a href="#1-3-3解决无法封装的问题：" class="headerlink" title="1.3.3解决无法封装的问题："></a>1.3.3解决无法封装的问题：</h6><ul>
<li>1.使用别名的方法进行封装<br>修改映射配置如下:   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">select id as userId,username as userName,birthday as userBirthday,sex as userSex,address as userAddress from user</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure></li>
<li>2.使用resultMap配置参数:<br>代码如下:   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id&#x3D;&quot;userMap&quot; type&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">       &lt;id property&#x3D;&quot;userId&quot; column&#x3D;&quot;id&quot;&gt;&lt;&#x2F;id&gt;</span><br><span class="line">       &lt;result property&#x3D;&quot;userName&quot; column&#x3D;&quot;username&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">       &lt;result property&#x3D;&quot;userSex&quot; column&#x3D;&quot;sex&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">       &lt;result property&#x3D;&quot;userAddress&quot; column&#x3D;&quot;address&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">       &lt;result property&#x3D;&quot;userBirthday&quot; column&#x3D;&quot;birthday&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">   &lt;&#x2F;resultMap&gt;</span><br><span class="line">   &lt;select id&#x3D;&quot;findAll&quot; resultMap&#x3D;&quot;userMap&quot;&gt;</span><br><span class="line">       select * from user</span><br><span class="line">   &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure></li>
<li>3.分析两者的区别：<br>用别名的方式会提高一些效率，但是每个查询代码就会加入许多重复的代码<br>用resultMap可以减少代码的重复但是比用别名效率低一点     <h4 id="3-使用selectKey参数"><a href="#3-使用selectKey参数" class="headerlink" title="3.使用selectKey参数:"></a>3.使用selectKey参数:</h4><h5 id="3-1使用说明："><a href="#3-1使用说明：" class="headerlink" title="3.1使用说明："></a>3.1使用说明：</h5>是用来获取保存时插入的id的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id&#x3D;&quot;save&quot; parameterType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        &lt;selectKey keyColumn&#x3D;&quot;id&quot; keyProperty&#x3D;&quot;userId&quot; resultType&#x3D;&quot;int&quot;&gt; </span><br><span class="line">            select last_insert_id();</span><br><span class="line">        &lt;&#x2F;selectKey&gt;</span><br><span class="line">        insert into user(username,sex,address,birthday) values (#&#123;userName&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;,#&#123;userBirthday&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure>
测试结果：<br><img src="/images/mybatis10.png">     <h2 id="Step-6-传统的Mybatis-使用Dao开发【了解就行】"><a href="#Step-6-传统的Mybatis-使用Dao开发【了解就行】" class="headerlink" title="#Step 6: 传统的Mybatis 使用Dao开发【了解就行】"></a>#Step 6: 传统的Mybatis 使用Dao开发【了解就行】</h2></li>
</ul>
<hr>
<p>使用 Mybatis 开发 Dao，通常有两个方法，即原始 Dao 开发方式和 Mapper 接口代理开发方式。而现在主流<br>的开发方式是接口代理开发方式，这种方式总体上更加简便。我们的课程讲解也主要以接口代理开发方式为主。在<br>第二章节已经给大家介绍了基于代理方式的 dao 开发，现在给大家介绍一下基于传统编写 Dao 实现类的开发方式。        </p>
<h4 id="1-在dao包下面创建一个impl包写一个IUserDaoImpl类实现IUserDao接口-代码如下："><a href="#1-在dao包下面创建一个impl包写一个IUserDaoImpl类实现IUserDao接口-代码如下：" class="headerlink" title="1.在dao包下面创建一个impl包写一个IUserDaoImpl类实现IUserDao接口  代码如下："></a>1.在dao包下面创建一个impl包写一个IUserDaoImpl类实现IUserDao接口  代码如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.dao.impl;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.dao.IUserDao;</span><br><span class="line">import com.itfeifei.domain.QueryVo;</span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class IUserDaoImpl implements IUserDao &#123;</span><br><span class="line">    private SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    public IUserDaoImpl(SqlSessionFactory sqlSessionFactory) &#123;</span><br><span class="line">        this.sqlSessionFactory &#x3D; sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;User&gt; findAll() &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        List&lt;User&gt; users &#x3D; session.selectList(&quot;com.itfeifei.dao.IUserDao.findAll&quot;);</span><br><span class="line">        session.close();</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void save(User user) &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        session.insert(&quot;com.itfeifei.dao.IUserDao.save&quot;,user);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void updateUser(User user) &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        session.selectList(&quot;com.itfeifei.dao.IUserDao.updateUser&quot;,user);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void deleteUser(Integer id) &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        session.selectList(&quot;com.itfeifei.dao.IUserDao.deleteUser&quot;,id);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;User&gt; findByName(String username) &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        List&lt;User&gt; users &#x3D; session.selectList(&quot;com.itfeifei.dao.IUserDao.findByName&quot;,username);</span><br><span class="line">        session.close();</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer findTotal() &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        int total &#x3D; session.selectOne(&quot;com.itfeifei.dao.IUserDao.findTotal&quot;);</span><br><span class="line">        session.close();</span><br><span class="line">        return total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;User&gt; findByVo(QueryVo vo) &#123;</span><br><span class="line">        SqlSession session &#x3D; sqlSessionFactory.openSession();</span><br><span class="line">        List&lt;User&gt; users &#x3D; session.selectList(&quot;com.itfeifei.dao.IUserDao.findByVo&quot;, vo);</span><br><span class="line">        session.close();</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-映射配置文件如下"><a href="#2-映射配置文件如下" class="headerlink" title="2.映射配置文件如下"></a>2.映射配置文件如下</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.itfeifei.dao.IUserDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;userMap&quot; type&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;userId&quot; column&#x3D;&quot;id&quot;&gt;&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userName&quot; column&#x3D;&quot;username&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userSex&quot; column&#x3D;&quot;sex&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userAddress&quot; column&#x3D;&quot;address&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userBirthday&quot; column&#x3D;&quot;birthday&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultMap&#x3D;&quot;userMap&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id&#x3D;&quot;save&quot; parameterType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        &lt;selectKey keyColumn&#x3D;&quot;id&quot; keyProperty&#x3D;&quot;userId&quot; resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">            select last_insert_id();</span><br><span class="line">        &lt;&#x2F;selectKey&gt;</span><br><span class="line">        insert into user(username,sex,address,birthday) values (#&#123;userName&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;,#&#123;userBirthday&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id&#x3D;&quot;updateUser&quot; parameterType&#x3D;&quot;com.itfeifei.domain.User&quot;&gt;</span><br><span class="line">        update user set username &#x3D; #&#123;userName&#125;, address &#x3D; #&#123;userAddress&#125; where id &#x3D; #&#123;userId&#125;</span><br><span class="line">    &lt;&#x2F;update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;delete id&#x3D;&quot;deleteUser&quot; parameterType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        delete from user where id &#x3D; #&#123;uId&#125;</span><br><span class="line">    &lt;&#x2F;delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;String&quot; resultMap&#x3D;&quot;userMap&quot;&gt;</span><br><span class="line">        select * from user where username like #&#123;uname&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findTotal&quot; resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        select count(*) from user;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findByVo&quot; resultMap&#x3D;&quot;userMap&quot; parameterType&#x3D;&quot;com.itfeifei.domain.QueryVo&quot;&gt;</span><br><span class="line">        select * from user where username like #&#123;user.userName&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>
<h4 id="3-SqlMapConfig-xml配置文件如下"><a href="#3-SqlMapConfig-xml配置文件如下" class="headerlink" title="3.SqlMapConfig.xml配置文件如下:"></a>3.SqlMapConfig.xml配置文件如下:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&gt;&lt;&#x2F;transactionManager&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;eesy_mybatis&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;112244&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;itfeifei&#x2F;dao&#x2F;IUserDao.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4-测试方法如下"><a href="#4-测试方法如下" class="headerlink" title="4.测试方法如下:"></a>4.测试方法如下:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">package com.itfeifei.test;</span><br><span class="line"></span><br><span class="line">import com.itfeifei.dao.IUserDao;</span><br><span class="line">import com.itfeifei.dao.impl.IUserDaoImpl;</span><br><span class="line">import com.itfeifei.domain.QueryVo;</span><br><span class="line">import com.itfeifei.domain.User;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class MybatisCRUD &#123;</span><br><span class="line">    private InputStream in;</span><br><span class="line">    private IUserDao userDao;</span><br><span class="line">    private SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1.读取配置文件</span><br><span class="line">        in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2.创建构建者对象</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        &#x2F;&#x2F;3.构建session工厂对象</span><br><span class="line">        sqlSessionFactory &#x3D; builder.build(in);</span><br><span class="line">        &#x2F;&#x2F;4.创建Dao接口实现类</span><br><span class="line">        userDao &#x3D; new IUserDaoImpl(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void close() throws IOException &#123;</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 测试查询</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findAll()&#123;</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">        for (User user : users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除测试</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void deleteTest()&#123;</span><br><span class="line">        int i &#x3D; 51;</span><br><span class="line">        userDao.deleteUser(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void saveTest()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setUserName(&quot;foo&quot;);</span><br><span class="line">        user.setUserBirthday(new Date());</span><br><span class="line">        user.setUserAddress(&quot;123456&quot;);</span><br><span class="line">        user.setUserSex(&quot;男&quot;);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        userDao.save(user);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    @Test</span><br><span class="line">    public void updateUserTest()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setUserId(46);</span><br><span class="line">        user.setUserName(&quot;foo&quot;);</span><br><span class="line">        user.setUserBirthday(new Date());</span><br><span class="line">        user.setUserAddress(&quot;123456&quot;);</span><br><span class="line">        user.setUserSex(&quot;男&quot;);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询通过姓名查找</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findByNameTest()&#123;</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findByName(&quot;老&quot;);</span><br><span class="line">        for(User user : users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 使用聚合函数查询</span><br><span class="line">     * 查询总记录条数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findTotalTest()&#123;</span><br><span class="line">        int total &#x3D; userDao.findTotal();</span><br><span class="line">        System.out.println(total);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 条件查询测试</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void findByVoTest()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setUserName(&quot;%王%&quot;);</span><br><span class="line">        QueryVo queryVo &#x3D; new QueryVo();</span><br><span class="line">        queryVo.setUser(user);</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findByVo(queryVo);</span><br><span class="line">        for (User user1 : users)&#123;</span><br><span class="line">            System.out.println(user1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Step-7-SqlMapConfig-xml配置文件"><a href="#Step-7-SqlMapConfig-xml配置文件" class="headerlink" title="#Step 7:SqlMapConfig.xml配置文件"></a>#Step 7:SqlMapConfig.xml配置文件</h2><hr>
<h4 id="1-SqlMapConfig-xml配置内容和顺序"><a href="#1-SqlMapConfig-xml配置内容和顺序" class="headerlink" title="1.SqlMapConfig.xml配置内容和顺序"></a>1.SqlMapConfig.xml配置内容和顺序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-properties（属性）</span><br><span class="line">--property</span><br><span class="line">-settings（全局配置参数）</span><br><span class="line">--setting</span><br><span class="line">-typeAliases（类型别名）</span><br><span class="line">--typeAliase</span><br><span class="line">--package</span><br><span class="line">-typeHandlers（类型处理器）</span><br><span class="line">-objectFactory（对象工厂）</span><br><span class="line">-plugins（插件）</span><br><span class="line">-environments（环境集合属性对象）</span><br><span class="line">--environment（环境子属性对象）</span><br><span class="line">---transactionManager（事务管理）</span><br><span class="line">---dataSource（数据源）</span><br><span class="line">-mappers（映射器）</span><br><span class="line">--mapper</span><br><span class="line">--package</span><br></pre></td></tr></table></figure>
<h4 id="2-properties-属性"><a href="#2-properties-属性" class="headerlink" title="2.properties(属性)"></a>2.properties(属性)</h4><p>使用properties标签配置时，我们可以采用两种指定的方式进行属性配置</p>
<h5 id="2-1第一种-相对地址的方式"><a href="#2-1第一种-相对地址的方式" class="headerlink" title="2.1第一种:相对地址的方式"></a>2.1第一种:相对地址的方式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource&#x3D;&quot;jdbcConfig.properties&quot;&gt;&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-2第二种-地对地址的方式"><a href="#2-2第二种-地对地址的方式" class="headerlink" title="2.2第二种:地对地址的方式"></a>2.2第二种:地对地址的方式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties url&#x3D;&quot;file:&#x2F;&#x2F;&#x2F;D:&#x2F;新建文件夹 (2)&#x2F;mybatis_CRUD_01&#x2F;src&#x2F;main&#x2F;resources&#x2F;jdbcConfig.properties&quot;&gt;&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-3配置这个properties标签后就可以使用jdbcConfig-properties"><a href="#2-3配置这个properties标签后就可以使用jdbcConfig-properties" class="headerlink" title="2.3配置这个properties标签后就可以使用jdbcConfig.properties"></a>2.3配置这个properties标签后就可以使用jdbcConfig.properties</h5><p>jdbcConfig.properties配置文件的内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver&#x3D;com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;eesy_mybatis</span><br><span class="line">jdbc.username&#x3D;root</span><br><span class="line">jdbc.password&#x3D;112244</span><br></pre></td></tr></table></figure>
<h5 id="2-4-SqlMapConifg-xml配置文件的property就可以使用下面的方式配置数据库连接需要的数据内容"><a href="#2-4-SqlMapConifg-xml配置文件的property就可以使用下面的方式配置数据库连接需要的数据内容" class="headerlink" title="2.4 SqlMapConifg.xml配置文件的property就可以使用下面的方式配置数据库连接需要的数据内容"></a>2.4 SqlMapConifg.xml配置文件的property就可以使用下面的方式配置数据库连接需要的数据内容</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">               &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;jdbc.driver&#125;&quot;&#x2F;&gt;</span><br><span class="line">               &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&#x2F;&gt;</span><br><span class="line">               &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&#x2F;&gt;</span><br><span class="line">               &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;dataSource&gt;</span><br></pre></td></tr></table></figure>
<h4 id="3-typeAliases-类型别名"><a href="#3-typeAliases-类型别名" class="headerlink" title="3.typeAliases(类型别名)"></a>3.typeAliases(类型别名)</h4><p>Mybatis 支持的默认别名，我们也可以采用自定义别名方式来开发。</p>
<h5 id="3-1自定义类型别名"><a href="#3-1自定义类型别名" class="headerlink" title="3.1自定义类型别名"></a>3.1自定义类型别名</h5><p>在SqlMapConfig.xml中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;!-- 单个别名定义 --&gt; </span><br><span class="line">    &lt;typeAlias alias&#x3D;&quot;user&quot; type&#x3D;&quot;com.itheima.domain.User&quot;&#x2F;&gt;</span><br><span class="line">    &lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span><br><span class="line">    &lt;package name&#x3D;&quot;com.itfeifei.domain&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;typeAliases&gt;</span><br></pre></td></tr></table></figure>
<p>这样就可以时在映射配置文件中的的配置改变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.itfeifei.dao.IUserDao&quot;&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;userMap&quot; type&#x3D;&quot;user&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;userId&quot; column&#x3D;&quot;id&quot;&gt;&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userName&quot; column&#x3D;&quot;username&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userSex&quot; column&#x3D;&quot;sex&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userAddress&quot; column&#x3D;&quot;address&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userBirthday&quot; column&#x3D;&quot;birthday&quot;&gt;&lt;&#x2F;result&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultMap&#x3D;&quot;userMap&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id&#x3D;&quot;save&quot; parameterType&#x3D;&quot;user&quot;&gt;</span><br><span class="line">        &lt;selectKey keyColumn&#x3D;&quot;id&quot; keyProperty&#x3D;&quot;userId&quot; resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">            select last_insert_id();</span><br><span class="line">        &lt;&#x2F;selectKey&gt;</span><br><span class="line">        insert into user(username,sex,address,birthday) values (#&#123;userName&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;,#&#123;userBirthday&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id&#x3D;&quot;updateUser&quot; parameterType&#x3D;&quot;UsEr&quot;&gt;</span><br><span class="line">        update user set username &#x3D; #&#123;userName&#125;, address &#x3D; #&#123;userAddress&#125; where id &#x3D; #&#123;userId&#125;</span><br><span class="line">    &lt;&#x2F;update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;delete id&#x3D;&quot;deleteUser&quot; parameterType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        delete from user where id &#x3D; #&#123;uId&#125;</span><br><span class="line">    &lt;&#x2F;delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;String&quot; resultMap&#x3D;&quot;userMap&quot;&gt;</span><br><span class="line">        select * from user where username like &#39;%$&#123;value&#125;%&#39;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findTotal&quot; resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">        select count(*) from user;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findByVo&quot; resultMap&#x3D;&quot;userMap&quot; parameterType&#x3D;&quot;com.itfeifei.domain.QueryVo&quot;&gt;</span><br><span class="line">        select * from user where username like #&#123;user.userName&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>
<p>前面写的com.itfeifei.domain.User全变成了user 或 UsEr</p>
<h4 id="4-mappers-映射器"><a href="#4-mappers-映射器" class="headerlink" title="4.mappers(映射器)"></a>4.mappers(映射器)</h4><h5 id="4-1"><a href="#4-1" class="headerlink" title="4.1:"></a>4.1<mapper resource=" ">:</mapper></h5><p>使用相当于类路径的资源  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper resource&#x3D;&quot;com&#x2F;itfeifei&#x2F;dao&#x2F;IUserDao.xml&quot;&#x2F;&gt;      </span><br></pre></td></tr></table></figure>
<h5 id="4-2"><a href="#4-2" class="headerlink" title="4.2 :"></a>4.2 <mapper class=" ">:</mapper></h5><p>使用 mapper 接口类路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如：&lt;mapper class&#x3D;&quot;com.itfeiifei.dao.UserDao&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</p>
<h5 id="4-3"><a href="#4-3" class="headerlink" title="4.3:"></a>4.3<package name>:</package></h5><p>注册指定包下的所有 mapper 接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;package name&#x3D;&quot;cn.itcast.mybatis.mapper&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>注意：此种方法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">John Doe</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2021/04/11/Mybatis%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">http://example.com/2021/04/11/Mybatis%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">John Doe</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;Current
            </div>
            <div class="card">
                <a href="/2021/04/11/Mybatis%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="Mybatis框架学习">
                        
                        <span class="card-title">Mybatis框架学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-04-11
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>

                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/04/07/ajax/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="ajax">
                        
                        <span class="card-title">ajax</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-04-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">John Doe</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/smallfeifei123" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1538211161@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1538211161" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1538211161" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
